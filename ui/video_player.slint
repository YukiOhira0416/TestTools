import { Button, VerticalBox, HorizontalBox, LineEdit, Slider } from "std-widgets.slint";

export component VideoPlayerUI inherits Window {
    title: "Video Player";
    preferred-width: 1300px;
    preferred-height: 700px;
    
    // ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£
    in-out property <string> video-path: "";
    in-out property <int> repeat-count: 1;
    in-out property <float> current-time: 0.0;
    in-out property <float> duration: 0.0;
    in-out property <bool> is-playing: false;
    in-out property <image> video-frame;
    in-out property <float> volume: 1.0; // 0.0 ~ 1.0
    
    // ã‚³ãƒ¼ãƒ«ãƒãƒƒã‚¯
    callback select-video();
    callback play-pause();
    callback stop();
    callback seek(float);
    callback repeat-changed(int);
    callback volume-changed(float);
    
    VerticalBox {
        padding: 20px;
        spacing: 10px;
        
        // ãƒ¡ã‚¤ãƒ³ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã‚¨ãƒªã‚¢
        HorizontalBox {
            spacing: 20px;
            
            // å‹•ç”»è¡¨ç¤ºã‚¨ãƒªã‚¢ï¼ˆå·¦å´ãƒ»960x600å›ºå®šï¼‰
            Rectangle {
                width: 960px;
                height: 600px;
                background: #000000;
                border-width: 2px;
                border-color: #333333;
                border-radius: 8px;
                
                if video-frame.width > 0: Image {
                    source: video-frame;
                    width: 100%;
                    height: 100%;
                    image-fit: contain;
                }
                
                if video-frame.width == 0: Text {
                    text: video-path == "" ? "å‹•ç”»ãƒ•ã‚¡ã‚¤ãƒ«ã‚’é¸æŠã—ã¦ãã ã•ã„" : "å‹•ç”»æº–å‚™ä¸­...";
                    color: #ffffff;
                    font-size: 20px;
                    horizontal-alignment: center;
                    vertical-alignment: center;
                }
            }
            
            // ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ«ãƒ‘ãƒãƒ«ï¼ˆå³å´ï¼‰
            VerticalBox {
                spacing: 12px;
                width: 280px;
                
                // ãƒ•ã‚¡ã‚¤ãƒ«é¸æŠã‚¨ãƒªã‚¢
                VerticalBox {
                    spacing: 4px;
                    
                    Text {
                        text: "å‹•ç”»ãƒ•ã‚¡ã‚¤ãƒ«";
                        font-size: 16px;
                        font-weight: 700;
                    }
                    
                    Rectangle {
                        border-width: 1px;
                        border-color: #cccccc;
                        border-radius: 4px;
                        background: white;
                        height: 40px;
                        
                        VerticalLayout {
                            padding: 6px;
                            
                            Text {
                                text: video-path == "" ? "æœªé¸æŠ" : video-path;
                                vertical-alignment: center;
                                horizontal-alignment: left;
                                color: video-path == "" ? #999999 : #000000;
                                overflow: elide;
                                font-size: 11px;
                            }
                        }
                    }
                    
                    Button {
                        text: "ğŸ“ ãƒ•ã‚¡ã‚¤ãƒ«ã‚’é¸æŠ...";
                        clicked => {
                            select-video();
                        }
                    }
                }
                
                // ãƒªãƒ”ãƒ¼ãƒˆå›æ•°è¨­å®šã‚¨ãƒªã‚¢
                VerticalBox {
                    spacing: 4px;
                    
                    Text {
                        text: "ãƒªãƒ”ãƒ¼ãƒˆå›æ•°";
                        font-size: 16px;
                        font-weight: 700;
                    }
                    
                    HorizontalBox {
                        spacing: 8px;
                        
                        Button {
                            text: "-";
                            width: 45px;
                            clicked => {
                                if (repeat-count > 1) {
                                    repeat-count -= 1;
                                    repeat-changed(repeat-count);
                                }
                            }
                        }
                        
                        LineEdit {
                            text: repeat-count == -1 ? "âˆ" : repeat-count;
                            horizontal-stretch: 1;
                            horizontal-alignment: center;
                            edited(new-text) => {
                                if (new-text == "âˆ") {
                                    repeat-count = -1;
                                } else {
                                    repeat-count = new-text.to-float();
                                }
                                repeat-changed(repeat-count);
                            }
                        }
                        
                        Button {
                            text: "+";
                            width: 45px;
                            clicked => {
                                if (repeat-count == -1) {
                                    repeat-count = 1;
                                }
                                repeat-count += 1;
                                repeat-changed(repeat-count);
                            }
                        }
                    }
                    
                    Button {
                        text: "âˆ ç„¡é™ãƒªãƒ”ãƒ¼ãƒˆ";
                        clicked => {
                            repeat-count = -1;
                            repeat-changed(repeat-count);
                        }
                    }
                }
                
                // ãƒœãƒªãƒ¥ãƒ¼ãƒ ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ«
                VerticalBox {
                    spacing: 4px;
                    
                    Text {
                        text: "éŸ³é‡";
                        font-size: 16px;
                        font-weight: 700;
                    }
                    
                    HorizontalBox {
                        spacing: 10px;
                        alignment: center;
                        
                        Text {
                            text: volume == 0 ? "ğŸ”‡" : volume < 0.5 ? "ğŸ”‰" : "ğŸ”Š";
                            font-size: 20px;
                            width: 30px;
                        }
                        
                        Slider {
                            minimum: 0;
                            maximum: 1;
                            value: volume;
                            changed(new-value) => {
                                volume = new-value;
                                volume-changed(new-value);
                            }
                        }
                        
                        Text {
                            text: Math.round(volume * 100) + "%";
                            font-size: 12px;
                            width: 45px;
                            horizontal-alignment: right;
                        }
                    }
                    
                    HorizontalBox {
                        spacing: 5px;
                        
                        Button {
                            text: "0%";
                            width: 60px;
                            clicked => {
                                volume = 0.0;
                                volume-changed(volume);
                            }
                        }
                        
                        Button {
                            text: "50%";
                            width: 60px;
                            clicked => {
                                volume = 0.5;
                                volume-changed(volume);
                            }
                        }
                        
                        Button {
                            text: "100%";
                            width: 60px;
                            clicked => {
                                volume = 1.0;
                                volume-changed(volume);
                            }
                        }
                    }
                }
                
                // å†ç”Ÿã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ«
                VerticalBox {
                    spacing: 4px;
                    
                    Text {
                        text: "å†ç”Ÿã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ«";
                        font-size: 16px;
                        font-weight: 700;
                    }
                    
                    Button {
                        text: is-playing ? "â¸ ä¸€æ™‚åœæ­¢" : "â–¶ å†ç”Ÿ";
                        primary: true;
                        clicked => {
                            play-pause();
                        }
                    }
                    
                    Button {
                        text: "â¹ åœæ­¢";
                        clicked => {
                            stop();
                        }
                    }
                }
                
                // æƒ…å ±è¡¨ç¤º
                Rectangle {
                    border-width: 1px;
                    border-color: #e0e0e0;
                    border-radius: 4px;
                    background: #f5f5f5;
                    padding: 12px;
                    
                    VerticalBox {
                        spacing: 5px;
                        
                        Text {
                            text: "ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹";
                            font-size: 14px;
                            font-weight: 700;
                        }
                        
                        Text {
                            text: is-playing ? "â–¶ å†ç”Ÿä¸­" : "â¸ åœæ­¢";
                            color: is-playing ? #00aa00 : #666666;
                            font-size: 13px;
                        }
                        
                        Text {
                            text: "æ™‚é–“: " + format-time(current-time) + " / " + format-time(duration);
                            color: #666666;
                            font-size: 12px;
                        }
                        
                        Text {
                            text: repeat-count == -1 ? "ãƒªãƒ”ãƒ¼ãƒˆ: ç„¡é™" : "ãƒªãƒ”ãƒ¼ãƒˆ: " + repeat-count + "å›";
                            color: #666666;
                            font-size: 12px;
                        }
                    }
                }
                
                Rectangle {
                    vertical-stretch: 1;
                }
            }
        }
        
        // ã‚·ãƒ¼ã‚¯ãƒãƒ¼
        Rectangle {
            background: #f8f8f8;
            border-radius: 6px;
            padding: 10px;
            
            HorizontalBox {
                spacing: 12px;
                
                Text {
                    text: format-time(current-time);
                    width: 60px;
                    vertical-alignment: center;
                    font-size: 14px;
                    font-weight: 600;
                    color: #333333;
                }
                
                Slider {
                    horizontal-stretch: 1;
                    minimum: 0;
                    maximum: duration > 0 ? duration : 100;
                    value: current-time;
                    changed(new-value) => {
                        seek(new-value);
                    }
                }
                
                Text {
                    text: format-time(duration);
                    width: 60px;
                    vertical-alignment: center;
                    horizontal-alignment: right;
                    font-size: 14px;
                    font-weight: 600;
                    color: #333333;
                }
            }
        }
    }
    
    // æ™‚é–“ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆé–¢æ•°
    pure function format-time(seconds: float) -> string {
        Math.floor(seconds / 60) + ":" + 
        (Math.floor(Math.mod(seconds, 60)) < 10 ? "0" : "") + 
        Math.floor(Math.mod(seconds, 60))
    }
}
